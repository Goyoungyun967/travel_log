<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.iei.seller.model.dao.SellerDao">
 	<!-- 등록한 호텔 조회 -->
 	<select id="selectLodgmentList" resultType="lodgmentStorage">
 		select * from LODGMENT_STORAGE where seller_no=#{sellerNo}
 	</select>
 	
 	<!-- 기존 호텔 검색 - 이름이나 주소에 해당 단어 섞여 있으면 조회 (리스트) -->
	<select id="selectXlsxHotelInfo" resultType="hotelXlsx">
		select * from HOTEL_XLSX
		where X_LODGMENT_NAME like '%'||#{searchInfo}||'%'
		or X_LODGMENT_ADDR like '%'||#{searchInfo}||'%'
	</select>
	
	<!-- 해당 호텔 조회 -->
	<select id="selectOneLodgment" resultType="lodgmentStorage">
		select * from lodgment_storage
		where lodgment_no = #{lodgmentNo}
	</select>
	
	<!-- 호텔 등록 -->
	<!-- lodgmentNo가 0이면 기존 호텔에 없는 번호이므로 시퀀스 돌리기 -->
	<insert id="insertLodgment">
		insert into lodgment_storage VALUES (
        							<if test="lodgmentNo == 0">
        							    lodgment_seq.nextval
        							</if>
							        <if test="lodgmentNo != 0">
							            #{lodgmentNo}
							        </if>,
							        #{sellerNo},
							        #{lodgmentTypeNo},
							        #{lodgmentName},
							        #{lodgmentAddr},
							        #{lodgmentImgPath},
							        #{lodgmentStarGrade},
							        #{lodgmentNotice},
							        #{lodgmentCheckIn},
							        #{lodgmentCheckOut}
    	)
	</insert>
	
	<!-- 호텔 등록하면 기존 호텔 테이블에서 삭제해주어야함 (primary key 땜시 안됨) -->
	<delete id="deleteLodgment">
		delete from HOTEL_XLSX where x_lodgment_no=#{lodgmentNo}
	</delete>
	
	 <!-- 객실 정보 조회 (객실 정보 + 파일들) -->
    <select id="selectRoomInfo" resultMap="RoomResultMap">
        SELECT
            r.room_no AS room_no,
            r.lodgment_no AS lodgment_no,
            r.room_name AS room_name,
            r.room_qua AS room_qua,
            r.room_max_capacity AS room_max_capacity,
            r.room_price AS room_price,
            r.room_info AS room_info,
            rf.room_file_no AS room_file_no,
            rf.room_img AS room_img
        FROM
            room r
        LEFT JOIN
            room_file rf ON r.room_no = rf.room_no
        WHERE
            r.lodgment_no = #{lodgmentNo}
    </select>

    <!-- 객실 정보와 파일 정보를 묶어주는 ResultMap -->
    <resultMap type="room" id="RoomResultMap">
        <id column="room_no" property="roomNo" />
        <result column="lodgment_no" property="lodgmentNo" />
        <result column="room_name" property="roomName" />
        <result column="room_qua" property="roomQua" />
        <result column="room_max_capacity" property="roomMaxCapacity" />
        <result column="room_price" property="roomPrice" />
        <result column="room_info" property="roomInfo" />
        <collection 
        	property="fileList"
        	ofType="roomFile"
        	javaType="java.util.List"
        >
        <id property="roomFileNo" column="room_file_no"/>
            <result property="roomImg" column="room_img"/>
            </collection>
    </resultMap>

</mapper>
